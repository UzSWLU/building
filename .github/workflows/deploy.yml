name: Deploy Building API

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup environment
        run: |
          echo "ğŸš€ Starting Building API deployment..."
          echo "ğŸ“ Working directory: $(pwd)"
          echo "ğŸ“… Deployment time: $(date)"

      - name: Setup Docker Buildx
        uses: docker/setup-buildx-action@v3
        
      - name: Build Docker image
        run: |
          echo "ğŸ”¨ Building Docker image..."
          docker build -f Dockerfile.prod -t building-api:latest .
          
      - name: Test Docker image
        run: |
          echo "ğŸ§ª Testing Docker image..."
          docker run --rm building-api:latest python manage.py check
          
      - name: Build success
        run: |
          echo "âœ… Docker image built successfully!"
          echo "ğŸ“Š Image details:"
          docker images building-api:latest

      - name: Deployment success
        run: |
          echo ""
          echo "âœ… =============================================="
          echo "âœ… BUILDING API BUILD COMPLETED!"
          echo "âœ… =============================================="
          echo ""
          echo "ğŸ”— Docker image: building-api:latest"
          echo "ğŸ”— Ready for deployment to server"
          echo ""
          echo "ğŸ“‹ Next steps:"
          echo "1. Push image to registry"
          echo "2. Deploy to production server"
          echo "3. Configure domain: https://building.swagger.uzswlu.uz/"
          echo ""
          echo "ğŸ‘¤ Default Admin Credentials:"
          echo "   Username: admin"
          echo "   Password: admin123"
